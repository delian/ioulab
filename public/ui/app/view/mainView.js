/*
 * File: app/view/mainView.js
 *
 * This file was generated by Sencha Architect version 3.0.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('iouLab.view.mainView', {
    extend: 'Ext.container.Viewport',

    layout: {
        type: 'fit'
    },

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'container',
                    layout: {
                        align: 'stretch',
                        type: 'hbox'
                    },
                    items: [
                        {
                            xtype: 'treepanel',
                            flex: 1,
                            frame: true,
                            id: 'treeMenu',
                            maxWidth: 250,
                            autoScroll: true,
                            resizable: {
                                pinned: true,
                                //dynamic:true,
                                minWidth: 50
                            },
                            resizeHandles: 'e',
                            animCollapse: true,
                            collapseDirection: 'left',
                            collapseFirst: false,
                            collapsed: false,
                            collapsible: true,
                            title: 'Select Service',
                            rowLines: true,
                            store: 'treeMenu',
                            lines: false,
                            root: 'root',
                            rootVisible: false,
                            viewConfig: {
                                stripeRows: true,
                                animate: true
                            },
                            listeners: {
                                select: {
                                    fn: me.onTreepanelSelect,
                                    scope: me
                                },
                                render: {
                                    fn: me.onTreeMenuRender,
                                    scope: me
                                }
                            }
                        },
                        {
                            xtype: 'container',
                            flex: 4,
                            layout: {
                                type: 'fit'
                            },
                            items: [
                                {
                                    xtype: 'tabpanel',
                                    id: 'tabList',
                                    itemId: 'tabPanel',
                                    bodyBorder: false,
                                    overlapHeader: false,
                                    activeTab: 6,
                                    items: [
                                        {
                                            xtype: 'panel',
                                            itemId: 'manageLabs',
                                            title: 'Manage Labs',
                                            items: [
                                                {
                                                    xtype: 'panel',
                                                    header: false,
                                                    title: 'Create/Delete Labs',
                                                    items: [
                                                        {
                                                            xtype: 'gridpanel',
                                                            autoScroll: true,
                                                            title: 'Edit Labs',
                                                            forceFit: true,
                                                            store: 'editLabs',
                                                            columns: [
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    hidden: true,
                                                                    dataIndex: 'id',
                                                                    text: 'Id'
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    dataIndex: 'name',
                                                                    text: 'Name',
                                                                    flex: 1,
                                                                    editor: {
                                                                        xtype: 'textfield'
                                                                    }
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    dataIndex: 'description',
                                                                    text: 'Description',
                                                                    flex: 3,
                                                                    editor: {
                                                                        xtype: 'textfield'
                                                                    }
                                                                },
                                                                {
                                                                    xtype: 'actioncolumn',
                                                                    maxWidth: 50,
                                                                    align: 'center',
                                                                    items: [
                                                                        {
                                                                            handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                                                Ext.Msg.confirm('Delete?','Do you want to delete this LAB '+record.get('name')+'?',function(y) {
                                                                                    if (y==='yes') view.up("gridpanel").getStore().remove(record);
                                                                                });

                                                                            },
                                                                            altText: 'Delete',
                                                                            icon: 'icons/delete.png',
                                                                            tooltip: 'Delete'
                                                                        }
                                                                    ]
                                                                }
                                                            ],
                                                            tools: [
                                                                {
                                                                    xtype: 'tool',
                                                                    handler: function(event, toolEl, owner, tool) {
                                                                        owner.up("gridpanel").getStore().load();

                                                                    },
                                                                    type: 'refresh'
                                                                }
                                                            ],
                                                            plugins: [
                                                                Ext.create('Ext.grid.plugin.RowEditing', {

                                                                })
                                                            ],
                                                            dockedItems: [
                                                                {
                                                                    xtype: 'toolbar',
                                                                    dock: 'top',
                                                                    layout: {
                                                                        pack: 'end',
                                                                        type: 'hbox'
                                                                    },
                                                                    items: [
                                                                        {
                                                                            xtype: 'textfield',
                                                                            fieldLabel: 'Add new Lab',
                                                                            labelAlign: 'right',
                                                                            labelWidth: 90,
                                                                            emptyText: 'Enter lab name',
                                                                            enableKeyEvents: true,
                                                                            listeners: {
                                                                                keypress: {
                                                                                    fn: me.onTextfieldKeypress,
                                                                                    scope: me
                                                                                }
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'panel',
                                            itemId: 'manageIOU',
                                            title: 'Manage Device Templates',
                                            items: [
                                                {
                                                    xtype: 'panel',
                                                    header: false,
                                                    title: 'Manage Device Templates',
                                                    items: [
                                                        {
                                                            xtype: 'gridpanel',
                                                            autoScroll: true,
                                                            title: 'Edit Device Templates',
                                                            forceFit: true,
                                                            store: 'iouTemplates',
                                                            tools: [
                                                                {
                                                                    xtype: 'tool',
                                                                    handler: function(event, toolEl, owner, tool) {
                                                                        owner.up("gridpanel").getStore().load();

                                                                    },
                                                                    type: 'refresh'
                                                                }
                                                            ],
                                                            plugins: [
                                                                Ext.create('Ext.grid.plugin.RowEditing', {

                                                                })
                                                            ],
                                                            dockedItems: [
                                                                {
                                                                    xtype: 'toolbar',
                                                                    dock: 'top',
                                                                    layout: {
                                                                        pack: 'end',
                                                                        type: 'hbox'
                                                                    },
                                                                    items: [
                                                                        {
                                                                            xtype: 'combobox',
                                                                            fieldLabel: 'Add new Template',
                                                                            labelAlign: 'right',
                                                                            labelWidth: 130,
                                                                            emptyText: 'Select Type',
                                                                            enableKeyEvents: true,
                                                                            editable: false,
                                                                            displayField: 'id',
                                                                            store: 'iouBase',
                                                                            listeners: {
                                                                                change: {
                                                                                    fn: me.onTextfieldKeypress1,
                                                                                    scope: me
                                                                                }
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            ],
                                                            columns: [
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    hidden: true,
                                                                    dataIndex: 'id',
                                                                    text: 'Id',
                                                                    flex: 1
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    dataIndex: 'name',
                                                                    text: 'Name',
                                                                    flex: 1
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    dataIndex: 'description',
                                                                    text: 'Description',
                                                                    flex: 4,
                                                                    editor: {
                                                                        xtype: 'textfield'
                                                                    }
                                                                },
                                                                {
                                                                    xtype: 'templatecolumn',
                                                                    tpl: [
                                                                        '<IMG SRC="{icon}" width=15 height=15/>'
                                                                    ],
                                                                    align: 'center',
                                                                    dataIndex: 'icon',
                                                                    text: 'Icon',
                                                                    flex: 0.7,
                                                                    editor: {
                                                                        xtype: 'combobox',
                                                                        listConfig: {
                                                                            getInnerTpl: function() {
                                                                                return '<img src="{id}" width=15 height=15><div style="font-size: 9pt">{name}</div>';
                                                                            }
                                                                        },
                                                                        allowBlank: false,
                                                                        allowOnlyWhitespace: false,
                                                                        editable: false,
                                                                        displayField: 'name',
                                                                        store: 'routerIcons',
                                                                        valueField: 'id'
                                                                    }
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    align: 'center',
                                                                    dataIndex: 'memory',
                                                                    text: 'Memory (Mb)',
                                                                    flex: 1,
                                                                    editor: {
                                                                        xtype: 'numberfield',
                                                                        allowDecimals: false,
                                                                        allowExponential: false,
                                                                        autoStripChars: true,
                                                                        maxValue: 512,
                                                                        minValue: 256
                                                                    }
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    align: 'center',
                                                                    dataIndex: 'nvram',
                                                                    text: 'Nvram (Kb)',
                                                                    flex: 1,
                                                                    editor: {
                                                                        xtype: 'numberfield',
                                                                        allowDecimals: false,
                                                                        allowExponential: false,
                                                                        autoStripChars: true,
                                                                        maxValue: 128,
                                                                        minValue: 32
                                                                    }
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    align: 'center',
                                                                    dataIndex: 'ethernet',
                                                                    text: 'Ethernet',
                                                                    flex: 1,
                                                                    editor: {
                                                                        xtype: 'numberfield',
                                                                        allowDecimals: false,
                                                                        allowExponential: false,
                                                                        autoStripChars: true,
                                                                        maxValue: 40,
                                                                        minValue: 0
                                                                    }
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    align: 'center',
                                                                    dataIndex: 'serial',
                                                                    text: 'Serial',
                                                                    flex: 1,
                                                                    editor: {
                                                                        xtype: 'numberfield',
                                                                        allowDecimals: false,
                                                                        allowExponential: false,
                                                                        autoStripChars: true,
                                                                        maxValue: 40,
                                                                        minValue: 0
                                                                    }
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    align: 'center',
                                                                    dataIndex: 'type',
                                                                    text: 'Type',
                                                                    flex: 1,
                                                                    editor: {
                                                                        xtype: 'combobox',
                                                                        allowBlank: false,
                                                                        allowOnlyWhitespace: false,
                                                                        editable: false,
                                                                        displayField: 'id',
                                                                        store: 'iouBase'
                                                                    }
                                                                },
                                                                {
                                                                    xtype: 'actioncolumn',
                                                                    maxWidth: 50,
                                                                    align: 'center',
                                                                    items: [
                                                                        {
                                                                            handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                                                Ext.Msg.confirm('Delete?','Do you want to delete this device type '+record.get('name')+'?',function(y) {
                                                                                    if (y==='yes') view.up("gridpanel").getStore().remove(record);
                                                                                });

                                                                            },
                                                                            icon: 'icons/delete.png'
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'panel',
                                            itemId: 'manageLab',
                                            title: 'Lab Devices',
                                            items: [
                                                {
                                                    xtype: 'panel',
                                                    title: 'Manage devices',
                                                    items: [
                                                        {
                                                            xtype: 'fieldset',
                                                            collapsible: true,
                                                            title: 'LAB',
                                                            items: [
                                                                {
                                                                    xtype: 'displayfield',
                                                                    anchor: '100%',
                                                                    itemId: 'labName',
                                                                    fieldLabel: 'LAB Name',
                                                                    labelAlign: 'right',
                                                                    labelWidth: 120
                                                                },
                                                                {
                                                                    xtype: 'displayfield',
                                                                    anchor: '100%',
                                                                    itemId: 'labDescription',
                                                                    fieldLabel: 'LAB Description',
                                                                    labelAlign: 'right',
                                                                    labelWidth: 120
                                                                },
                                                                {
                                                                    xtype: 'toolbar',
                                                                    border: '0 0 0 0',
                                                                    frame: false,
                                                                    items: [
                                                                        {
                                                                            xtype: 'button',
                                                                            text: 'Stop All',
                                                                            listeners: {
                                                                                click: {
                                                                                    fn: me.onButtonClick,
                                                                                    scope: me
                                                                                }
                                                                            }
                                                                        },
                                                                        {
                                                                            xtype: 'button',
                                                                            text: 'Start All',
                                                                            listeners: {
                                                                                click: {
                                                                                    fn: me.onButtonClick1,
                                                                                    scope: me
                                                                                }
                                                                            }
                                                                        },
                                                                        {
                                                                            xtype: 'tbfill'
                                                                        },
                                                                        {
                                                                            xtype: 'button',
                                                                            text: 'Reset All Startup Configs to Default',
                                                                            listeners: {
                                                                                click: {
                                                                                    fn: me.onButtonClick2,
                                                                                    scope: me
                                                                                }
                                                                            }
                                                                        },
                                                                        {
                                                                            xtype: 'button',
                                                                            text: 'Copy All Startup Configs to Default',
                                                                            listeners: {
                                                                                click: {
                                                                                    fn: me.onButtonClick3,
                                                                                    scope: me
                                                                                }
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            xtype: 'fieldset',
                                                            collapsible: true,
                                                            title: 'Devices',
                                                            items: [
                                                                {
                                                                    xtype: 'gridpanel',
                                                                    itemId: 'reviewDevices',
                                                                    autoScroll: true,
                                                                    title: 'Review Devices',
                                                                    forceFit: true,
                                                                    store: 'labDevices',
                                                                    tools: [
                                                                        {
                                                                            xtype: 'tool',
                                                                            handler: function(event, toolEl, owner, tool) {
                                                                                owner.up("gridpanel").getStore().load();

                                                                            },
                                                                            type: 'refresh'
                                                                        }
                                                                    ],
                                                                    listeners: {
                                                                        select: {
                                                                            fn: me.onGridpanelSelect1,
                                                                            scope: me
                                                                        }
                                                                    },
                                                                    columns: [
                                                                        {
                                                                            xtype: 'gridcolumn',
                                                                            hidden: true,
                                                                            dataIndex: 'id',
                                                                            text: 'Id'
                                                                        },
                                                                        {
                                                                            xtype: 'gridcolumn',
                                                                            align: 'center',
                                                                            dataIndex: 'status',
                                                                            text: 'Status',
                                                                            flex: 0.5
                                                                        },
                                                                        {
                                                                            xtype: 'templatecolumn',
                                                                            tpl: [
                                                                                '<IMG SRC="{icon}" width=15 height=15/>'
                                                                            ],
                                                                            align: 'center',
                                                                            text: 'Icon',
                                                                            flex: 0.3
                                                                        },
                                                                        {
                                                                            xtype: 'gridcolumn',
                                                                            dataIndex: 'name',
                                                                            text: 'Name',
                                                                            flex: 2,
                                                                            editor: {
                                                                                xtype: 'textfield'
                                                                            }
                                                                        },
                                                                        {
                                                                            xtype: 'gridcolumn',
                                                                            renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                                                                var r = Ext.StoreMgr.get('iouTemplates').getById(value);
                                                                                return r?r.get('name'):'';

                                                                            },
                                                                            dataIndex: 'type',
                                                                            text: 'Template',
                                                                            flex: 2
                                                                        },
                                                                        {
                                                                            xtype: 'actioncolumn',
                                                                            width: 120,
                                                                            align: 'center',
                                                                            items: [
                                                                                {
                                                                                    handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                                                        Ext.StoreMgr.get('deviceLinks').getProxy().url='/rest/device/'+record.get('id')+'/links';
                                                                                        Ext.StoreMgr.get('deviceLinks').load();
                                                                                        Ext.create('widget.links').show();

                                                                                    },
                                                                                    icon: 'icons/link.png',
                                                                                    tooltip: 'Show Links'
                                                                                },
                                                                                {
                                                                                    handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                                                        window.open('terminal.html#'+record.get('id'),'Terminal'+record.get('id'),"location=0,status=0,scrollbars=1,width=650,height=400");

                                                                                    },
                                                                                    icon: 'icons/terminal.png',
                                                                                    tooltip: 'Open Console'
                                                                                },
                                                                                {
                                                                                    handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                                                        console.log('We want to stop the device');
                                                                                        Ext.Ajax.request({
                                                                                            url: '/rest/device/'+record.get('id')+'/stop',
                                                                                            success: function(res) {
                                                                                                console.log('We did stop');
                                                                                                record.set('status','offline');
                                                                                                record.commit();
                                                                                            }
                                                                                        });
                                                                                    },
                                                                                    disabled: false,
                                                                                    icon: 'icons/stop.png',
                                                                                    tooltip: 'Stop'
                                                                                },
                                                                                {
                                                                                    handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                                                        console.log('We want to start the device');
                                                                                        Ext.Ajax.request({
                                                                                            url: '/rest/device/'+record.get('id')+'/start',
                                                                                            success: function(res) {
                                                                                                console.log('We did start');
                                                                                                record.set('status','online');
                                                                                                record.commit();
                                                                                            }
                                                                                        });
                                                                                    },
                                                                                    icon: 'icons/start.png',
                                                                                    tooltip: 'Start'
                                                                                },
                                                                                {
                                                                                    handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                                                        console.log('We want to reset the device');
                                                                                        Ext.Ajax.request({
                                                                                            url: '/rest/device/'+record.get('id')+'/reset',
                                                                                            success: function(res) {
                                                                                                console.log('We did reset');
                                                                                            }
                                                                                        });

                                                                                    },
                                                                                    icon: 'icons/reset.png',
                                                                                    tooltip: 'Reset to default'
                                                                                },
                                                                                {
                                                                                    handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                                                        console.log('We want to save the device');
                                                                                        Ext.Ajax.request({
                                                                                            url: '/rest/device/'+record.get('id')+'/save',
                                                                                            success: function(res) {
                                                                                                console.log('We did save');
                                                                                            }
                                                                                        });

                                                                                    },
                                                                                    icon: 'icons/save.png',
                                                                                    tooltip: 'Save to default'
                                                                                }
                                                                            ]
                                                                        }
                                                                    ],
                                                                    plugins: [
                                                                        Ext.create('Ext.grid.plugin.RowEditing', {

                                                                        })
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ],
                                            listeners: {
                                                activate: {
                                                    fn: me.onManageLabActivate,
                                                    scope: me
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'panel',
                                            itemId: 'labDiagram',
                                            title: 'Lab Diagram',
                                            items: [
                                                {
                                                    xtype: 'panel',
                                                    title: 'Lab diagram',
                                                    dockedItems: [
                                                        {
                                                            xtype: 'toolbar',
                                                            dock: 'top',
                                                            items: [
                                                                {
                                                                    xtype: 'tbfill'
                                                                },
                                                                {
                                                                    xtype: 'slider',
                                                                    itemId: 'scaler',
                                                                    width: 160,
                                                                    fieldLabel: 'Scale',
                                                                    labelAlign: 'right',
                                                                    labelWidth: 50,
                                                                    value: 35,
                                                                    minValue: 30,
                                                                    listeners: {
                                                                        change: {
                                                                            fn: me.onSliderChange1,
                                                                            scope: me
                                                                        }
                                                                    }
                                                                },
                                                                {
                                                                    xtype: 'button',
                                                                    text: 'Restart All'
                                                                }
                                                            ]
                                                        }
                                                    ],
                                                    items: [
                                                        {
                                                            xtype: 'container',
                                                            frame: false,
                                                            itemId: 'diagram',
                                                            layout: {
                                                                type: 'fit'
                                                            }
                                                        }
                                                    ]
                                                }
                                            ],
                                            listeners: {
                                                activate: {
                                                    fn: me.onLabDiagramActivate,
                                                    scope: me
                                                },
                                                deactivate: {
                                                    fn: me.onLabDiagramDeactivate,
                                                    scope: me
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'panel',
                                            itemId: 'editLabDiagram',
                                            title: 'Edit Lab Diagram',
                                            items: [
                                                {
                                                    xtype: 'panel',
                                                    layout: {
                                                        type: 'fit'
                                                    },
                                                    title: 'Lab diagram',
                                                    dockedItems: [
                                                        {
                                                            xtype: 'toolbar',
                                                            dock: 'top',
                                                            items: [
                                                                {
                                                                    xtype: 'combobox',
                                                                    listConfig: {
                                                                        getInnerTpl: function() {
                                                                            return '<img src="{icon}" width=15 height=15>&nbsp;{name}';
                                                                        }
                                                                    },
                                                                    fieldLabel: 'Add Device',
                                                                    labelAlign: 'right',
                                                                    labelWidth: 80,
                                                                    emptyText: 'Select Device',
                                                                    editable: false,
                                                                    displayField: 'name',
                                                                    store: 'iouTemplates',
                                                                    valueField: 'id',
                                                                    listeners: {
                                                                        change: {
                                                                            fn: me.onComboboxChange,
                                                                            scope: me
                                                                        }
                                                                    }
                                                                },
                                                                {
                                                                    xtype: 'combobox',
                                                                    listConfig: {
                                                                        getInnerTpl: function() {
                                                                            return '<img src="{icon}" width=15 height=15>&nbsp;{name}';
                                                                        }
                                                                    },
                                                                    fieldLabel: 'Add Link',
                                                                    labelAlign: 'right',
                                                                    labelWidth: 80,
                                                                    emptyText: 'Select Link',
                                                                    editable: false,
                                                                    displayField: 'name',
                                                                    store: 'linkIcons',
                                                                    valueField: 'id',
                                                                    listeners: {
                                                                        change: {
                                                                            fn: me.onComboboxChange1,
                                                                            scope: me
                                                                        }
                                                                    }
                                                                },
                                                                {
                                                                    xtype: 'tbfill'
                                                                },
                                                                {
                                                                    xtype: 'slider',
                                                                    itemId: 'scaler',
                                                                    width: 160,
                                                                    fieldLabel: 'Scale',
                                                                    labelAlign: 'right',
                                                                    labelWidth: 50,
                                                                    value: 35,
                                                                    minValue: 30,
                                                                    listeners: {
                                                                        change: {
                                                                            fn: me.onSliderChange,
                                                                            scope: me
                                                                        }
                                                                    }
                                                                },
                                                                {
                                                                    xtype: 'button',
                                                                    text: 'Restart All'
                                                                }
                                                            ]
                                                        }
                                                    ],
                                                    items: [
                                                        {
                                                            xtype: 'container',
                                                            frame: false,
                                                            itemId: 'diagram',
                                                            layout: {
                                                                type: 'fit'
                                                            }
                                                        }
                                                    ],
                                                    tools: [
                                                        {
                                                            xtype: 'tool',
                                                            handler: function(event, toolEl, owner, tool) {
                                                                console.log('Refresh is invoked!');
                                                                if (diagram) diagram.refresh();
                                                            },
                                                            type: 'refresh'
                                                        }
                                                    ]
                                                }
                                            ],
                                            listeners: {
                                                activate: {
                                                    fn: me.onEditLabDiagramActivate,
                                                    scope: me
                                                },
                                                deactivate: {
                                                    fn: me.onEditLabDiagramDeactivate,
                                                    scope: me
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'panel',
                                            itemId: 'labDocs',
                                            title: 'Lab Documents',
                                            items: [
                                                {
                                                    xtype: 'panel',
                                                    title: 'Documents in relation to the Lab'
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'panel',
                                            itemId: 'labs',
                                            title: 'Labs',
                                            items: [
                                                {
                                                    xtype: 'panel',
                                                    header: false,
                                                    title: 'Please select a Lab',
                                                    items: [
                                                        {
                                                            xtype: 'gridpanel',
                                                            id: 'selectLab',
                                                            autoScroll: true,
                                                            title: 'Please select a Lab',
                                                            forceFit: true,
                                                            store: 'editLabs',
                                                            columns: [
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    hidden: true,
                                                                    dataIndex: 'id',
                                                                    text: 'Id'
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    dataIndex: 'name',
                                                                    text: 'Name',
                                                                    flex: 1,
                                                                    editor: {
                                                                        xtype: 'textfield'
                                                                    }
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    dataIndex: 'description',
                                                                    text: 'Description',
                                                                    flex: 3,
                                                                    editor: {
                                                                        xtype: 'textfield'
                                                                    }
                                                                }
                                                            ],
                                                            tools: [
                                                                {
                                                                    xtype: 'tool',
                                                                    handler: function(event, toolEl, owner, tool) {
                                                                        owner.up("gridpanel").getStore().load();

                                                                    },
                                                                    type: 'refresh'
                                                                }
                                                            ],
                                                            listeners: {
                                                                select: {
                                                                    fn: me.onGridpanelSelect,
                                                                    scope: me
                                                                }
                                                            }
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onTreepanelSelect: function(rowmodel, record, index, eOpts) {
        var n=Ext.getCmp('tabList');
        var id=record.get('id');
        
        // Hide all
        n.down('#manageLabs').tab.hide();
        n.down('#manageIOU').tab.hide();
        n.down('#manageLab').tab.hide();
        n.down('#labDiagram').tab.hide();
        n.down('#editLabDiagram').tab.hide();
        n.down('#labDocs').tab.hide();
        n.down('#labs').tab.hide();
        
        if (n.down('#'+id)) n.down('#'+id).tab.show();
        
        if (id>0) {
            // We have a LAB
            labId = id; // The global LabID is selected
            n.down('#manageLab').tab.show();
            n.down('#labDiagram').tab.show();
            n.down('#editLabDiagram').tab.show();
            n.down('#labDocs').tab.show();
            n.setActiveTab(n.down('#labs')); // Deselect tab
            n.setActiveTab(n.down('#manageLab'));
            // Ext.StoreMgr.get('labDevices').getProxy().url='/rest/lab/'+labId+'/devices';
            // Ext.StoreMgr.get('labDevices').load();
        } else n.setActiveTab(n.down('#'+id));
        
    },

    onTreeMenuRender: function(component, eOpts) {
        component.getSelectionModel().select(component.getStore().getNodeById('labs'));
    },

    onTextfieldKeypress: function(textfield, e, eOpts) {
        //console.log('Enter new data');
        if (e.getCharCode() == Ext.EventObject.ENTER) {
            if (textfield.getValue() && textfield.validate()) {
                // We need to add this user
                var s=textfield.up("gridpanel").getStore();
                var p=textfield.up("gridpanel").getPlugin();
                p.cancelEdit();
                s.insert(0,{
                    description: "",
                    name: textfield.getValue()
                });
                p.startEdit(0,0);
                textfield.setValue("");
            }
        }
        
    },

    onTextfieldKeypress1: function(field, newValue, oldValue, eOpts) {
        //console.log('Enter new data');
        if (newValue) {
            if (field.getValue() && field.validate()) {
                // We need to add this user
                var s=field.up("gridpanel").getStore();
                var p=field.up("gridpanel").getPlugin();
                var r=field.getStore().getById(newValue);
                p.cancelEdit();
        
                s.insert(0,{
                    description: r.get('description'),
                    memory: r.get('memory'),
                    nvram: r.get('nvram'),
                    ethernet: r.get('ethernet'),
                    serial: r.get('serial'),
                    name: field.getValue(),
                    icon: Ext.StoreMgr.get('routerIcons').getAt(0).get('id'), // Get the first router Icon
                    type: newValue
                });
        
                p.startEdit(0,0);
                field.setValue("");
            }
        }
    },

    onButtonClick: function(button, e, eOpts) {
        console.log('Stop All');
        Ext.Ajax.request({
            url: '/rest/labs/'+labId+'/stop',
            success: function(res) {
                console.log('stop all');
                var s=button.up('panel').down('gridpanel').getStore();
                console.log('found ',s);
                setTimeout(function() {
                    s.load();
                },200); // Refresh the grid
            }
        });
        
    },

    onButtonClick1: function(button, e, eOpts) {
        Ext.Ajax.request({
            url: '/rest/labs/'+labId+'/start',
            success: function(res) {
                setTimeout(function() {
                    var s=button.up('panel').down('gridpanel').getStore();
                    s.load();
                },200); // Refresh the grid
            }
        });
    },

    onButtonClick2: function(button, e, eOpts) {
        Ext.Ajax.request({
            url: '/rest/labs/'+labId+'/reset',
            success: function(res) {
                setTimeout(function() {
                    var s=button.up('panel').down('gridpanel').getStore();
                    s.load();
                },200); // Refresh the grid
            }
        });
    },

    onButtonClick3: function(button, e, eOpts) {
        Ext.Ajax.request({
            url: '/rest/labs/'+labId+'/save',
            success: function(res) {
                setTimeout(function() {
                    var s=button.up('panel').down('gridpanel').getStore();
                    s.load();
                },200); // Refresh the grid
            }
        });
    },

    onGridpanelSelect1: function(rowmodel, record, index, eOpts) {
        var t = Ext.getCmp('treeMenu');
        t.getSelectionModel().select(t.getStore().getNodeById(record.get('id')));
        Ext.getCmp('selectLab').getSelectionModel().deselectAll();
    },

    onManageLabActivate: function(component, eOpts) {
        console.log('Manage Lab activated');
        component.down('#reviewDevices').getStore().getProxy().url='/rest/lab/'+labId+'/devices';
        component.down('#reviewDevices').getStore().load(); // Refresh because the devices may have been changed
        
        Ext.Ajax.request({
            url: '/rest/labs/'+labId,
            success: function(res) {
                var obj = Ext.JSON.decode(res.responseText);
                component.down('#labName').setValue(obj.name);
                component.down('#labDescription').setValue(obj.description);
            }
        });
        
    },

    onSliderChange1: function(slider, newValue, thumb, eOpts) {
        console.log('Scaler value change');
        diagram.setScale(parseInt(newValue)/100,parseInt(newValue)/100);
        
    },

    onLabDiagramActivate: function(component, eOpts) {
        console.log('editLab is selected',arguments);
        diagram = new createDiagram(component.down('#diagram'),labId,true,{
            sockSetScale: function(msg) {
        //        var scaler = component.down('#scaler');
        //        scaler.suspendEvents();
        //        scaler.setValue(msg.x*100);
        //        scaler.resumeEvents();
            },
            deviceDoubleClick: function(obj,x,y) {
                console.log('Device DoubleClick',arguments);
                var id = obj.attributes.id;
                window.open('terminal.html#'+id,'Terminal'+id,"location=0,status=0,scrollbars=1,width=650,height=400");
            },
            linkDoubleClick: function(obj,x,y) {
                console.log('Link DoubleClick',arguments);
            }
        });
        
    },

    onLabDiagramDeactivate: function(component, eOpts) {
        if (diagram) {
            diagram.destroy();
        	diagram = null;
        }
        
    },

    onComboboxChange: function(field, newValue, oldValue, eOpts) {
        if (newValue) {
            if (field.getValue() && field.validate()) {
                var record = field.getStore().getById(newValue);
                console.log('Add device',record.get('name'));
        
                diagram.addDevice(100+Math.random()*100,100+Math.random()*100,newValue);
        
                field.setValue("");
            }
        }
        
    },

    onComboboxChange1: function(field, newValue, oldValue, eOpts) {
        if (newValue) {
            if (field.getValue() && field.validate()) {
                var record = field.getStore().getById(newValue);
                console.log('Add link', record.get('name'));
        
                diagram.addLink(100+Math.random()*100,100+Math.random()*100,newValue);
        
                field.setValue("");
            }
        }
        
    },

    onSliderChange: function(slider, newValue, thumb, eOpts) {
        console.log('Scaler value change');
        diagram.setScale(parseInt(newValue)/100,parseInt(newValue)/100);
    },

    onEditLabDiagramActivate: function(component, eOpts) {
        console.log('editLab is selected',arguments);
        diagram = new createDiagram(component.down('#diagram'),labId,false,{
            sockSetScale: function(msg) {
                var scaler = component.down('#scaler');
                scaler.suspendEvents();
                scaler.setValue(msg.x*100);
                scaler.resumeEvents();
            },
            deviceDoubleClick: function(obj,x,y) {
                console.log('Device DoubleClick',arguments);
            },
            linkDoubleClick: function(obj,x,y) {
                console.log('Link DoubleClick',arguments);
            }
        });
        
    },

    onEditLabDiagramDeactivate: function(component, eOpts) {
        if (diagram) {
            diagram.destroy();
        	diagram = null;
        }
    },

    onGridpanelSelect: function(rowmodel, record, index, eOpts) {
        var t = Ext.getCmp('treeMenu');
        t.getSelectionModel().select(t.getStore().getNodeById(record.get('id')));
        Ext.getCmp('selectLab').getSelectionModel().deselectAll();
    }

});