<HEAD>
<style>
  h1 {
      margin-bottom: 20px;
      font: 20px/1.5 sans-serif;
  }
            
  .terminal {
      float: left;
      border: #000 solid 5px;
      font-family: "DejaVu Sans Mono", "Liberation
      Mono", monospace;
      font-size: 11px;
      color: #f0f0f0;
      background: #000;
  }
                                        
  .terminal-cursor {
      color: #000;
      background: #f0f0f0;
  }
</style>

<SCRIPT SRC="/socket.io/socket.io.js">
</SCRIPT>

<SCRIPT SRC="libs/term.js">
</SCRIPT>

<SCRIPT SRC="libs/terminal.js">
</SCRIPT>

<SCRIPT>

  function activateTerm() {

	 // Check if we have an ID
	 
	 if (location.hash == "") window.close(); // Close the window

	 var id = location.hash.match(/\d+/);

	 if (!id) window.close();

	 id = id[0];
	 
     var socket = io.connect('/term');
     socket.on('connect',function() {

	   socket.emit('joinTerm',id);

	   setTimeout(function() {
		   socket.emit('terminalConnect',""); // Emit terminal connect message
	   },50);
         
       var term = new Terminal({
         cols: 80,
         rows: 24,
         useStyle: true,
         screenKeys: true
       });
       
       term.on('title',function(title) {
         document.title = title;
       });
       
       term.open(document.body);

       term.on('data',function(data) {
         socket.emit('terminalIn',data);
       });
       
       socket.on('terminalOut',function(data) {
         console.log('Received Terminal Out',data);
         term.write(data.data);
       });
       
       socket.on('disconnect',function() {
         term.destroy();
         window.close(); // Force the window to close
       });
       
       // We shall catch also the window close
       
       term.write('\x1b[32mWelcole to Terminal\x1b[m\r\n');
     });
  }

</SCRIPT>

</HEAD>
                                                    
<BODY onload="activateTerm()">
</BODY>
