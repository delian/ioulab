<HEAD>
<style>
h1 {
	margin-bottom: 20px;
	font: 20px/1.5 sans-serif;
}

.terminal {
	float: left;
	border: #000000 solid 0px;
	font-family: "DejaVu Sans Mono", " Liberation Mono ", monospace;
	font-size: 10pt;
	color: #f0f0f0;
	background: #000000;
}

.terminal-cursor {
	color: #000;
	background: #f0f0f0;
}
</style>

<SCRIPT SRC="/socket.io/socket.io.js">
</SCRIPT>

<SCRIPT SRC="libs/term.js">
</SCRIPT>

<SCRIPT>

  function activateTerm() {

	 // Check if we have an ID
	 if (location.hash == "") window.close(); // Close the window
	 var id = location.hash.match(/\d+/);
	 if (!id) window.close();
	 id = id[0];

	 var minCols = 80;
	 var minRows = 10;
	 
     var socket = io.connect('/term');
     socket.on('connect',function() {

	   socket.emit('joinTerm',id);

       var term = new Terminal({
         cols: minCols,
         rows: minRows,
         useStyle: true,
         visualBell: true,
         screenKeys: true
       });

       window.onresize = function(evt) {
           console.log('window',evt,evt.target.innerWidth,evt.target.innerHeight);
           var cols = parseInt(evt.target.innerWidth/9.2);
           var rows = parseInt(evt.target.innerHeight/17.8);
           cols = cols>minCols?cols:minCols;
           rows = rows>minRows?rows:minRows;
           term.resize(cols,rows);
           socket.emit('terminalResize',{ rows: rows, cols: cols });
       }

       setTimeout(function() {
           window.onresize({ target:window });
		   socket.emit('terminalConnect',""); // Emit terminal connect message
       },100);
       
       term.on('title',function(title) {
         document.title = title;
       });
       
       term.open(document.getElementById('terminal'));

       term.on('data',function(data) {
         socket.emit('terminalIn',data);
       });
       
       socket.on('terminalOut',function(data) {
         console.log('Received Terminal Out',data);
         term.write(data.data);
       });

       socket.on('updateTerminal',function(data) {
         console.log('Update terminal');
         document.title = data.name; 
       })
       
       socket.on('disconnect',function() {
         term.destroy();
         window.close(); // Force the window to close
       });
       
       // We shall catch also the window close
       // term.write('\x1b[32mWelcole to Terminal\x1b[m\r\n');
     });
  }

</SCRIPT>

</HEAD>

<BODY onload="activateTerm()" BGCOLOR="#000000">
<DIV ID="terminal"></DIV>
</BODY>
